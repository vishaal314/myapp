4s
fi

# Stop existing container
echo "ğŸ›‘ Stopping existing container..."
docker stop myapp 2>/dev/null || echo "No container named 'myapp' running"
docker rm myapp 2>/dev/null || echo "No container named 'myapp' to remove"

# Run new container
echo "ğŸš€ Starting new container..."
docker run -d \
  --name myapp \
  --restart unless-stopped \
  -p 80:5000 \
  -v ***:/data \
  -e ENVIRONMENT=production \
  -e PYTHONUNBUFFERED=1 \
  ***/myapp:latest

if [ $? -ne 0 ]; then
  echo "âŒ Failed to start container"
  docker logs myapp 2>/dev/null
  exit 1
fi

# Wait for container to start
echo "â³ Waiting for container to start..."
sleep 10

# Verify container is running
echo "âœ… Verifying deployment..."
if docker ps | grep -q myapp; then
  echo "=============================================="
  echo "âœ… DEPLOYMENT SUCCESSFUL!"
  echo "=============================================="
  echo "Container Status:"
  docker ps | grep myapp
  echo ""
  echo "Recent Logs:"
  docker logs myapp --tail=20
  echo ""
  echo "Application URL: http://***"
  echo "=============================================="
else
  echo "=============================================="
  echo "âŒ DEPLOYMENT FAILED!"
  echo "=============================================="
  echo "Container is not running. Logs:"
  docker logs myapp 2>/dev/null
  exit 1
fi

# Cleanup old images
echo "ğŸ§¹ Cleaning up old Docker images..."
docker image prune -af || echo "Cleanup completed"

echo "âœ… Deployment complete!"

======END======
out: ==============================================
out: ğŸš€ Starting Deployment
out: ==============================================
out: ğŸ“ Navigating to app directory...
out: ğŸ“¥ Pulling latest image from Docker Hub...
out: latest: Pulling from ***/myapp
out: Digest: sha256:51eac98a4909ab1526eabec0041e62783e9a05bbb2d8eddd5021ffc31a66b695
out: Status: Image is up to date for ***/myapp:latest
out: docker.io/***/myapp:latest
out: ğŸ›‘ Stopping existing container...
out: myapp
out: myapp
out: ğŸš€ Starting new container...
out: 429dc342b74eff084e06ecfdee6c0384e3f47ce1d9daab49bb3caf64b947de4d
err: docker: Error response from daemon: failed to set up container networking: driver failed programming external connectivity on endpoint myapp (2652abda951bab05d9d8e498f748eb561768122b903aac226b68c773f416104d): failed to bind host port for 0.0.0.0:80:172.17.0.3:5000/tcp: address already in use
err: Run 'docker run --help' for more information
out: âŒ Failed to start container
2025/11/14 23:09:53 Process exited with status 1