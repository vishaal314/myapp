^Croot@vishaalnoord7:~# ./fix_all_errors_external.sh
ðŸ”§ FIXING ALL ERRORS ON EXTERNAL SERVER
========================================

This will fix:
  âŒ All Redis connection attempts failed
  âŒ Failed to derive local KEK: Incorrect padding

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 1: GENERATE FRESH ENCRYPTION KEYS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Generated DATAGUARDIAN_MASTER_KEY
âœ… Generated JWT_SECRET
âœ… Preserved existing API keys

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 2: CREATE FIXED ENVIRONMENT FILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Environment file created at /root/.dataguardian_env

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 3: STOP CONTAINER & CLEAR ENCRYPTED DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Stopping container...
dataguardian-container
dataguardian-container
âœ… Container stopped
Clearing Redis cache...
âš ï¸  Redis not accessible, will start it
Clearing cached encrypted files...
âœ… Cache files cleared

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 4: ENSURE REDIS IS RUNNING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Starting Redis server...
âŒ Redis still not accessible!
Trying to start manually...
âŒ Redis failed to start - continuing anyway

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 5: START CONTAINER WITH FIXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Starting container with --network host...
WARNING: Published ports are discarded when using host network mode
d401aed246063022a107f667258c620866bf7ec28ed17937c095a42a13fb0ee2
âœ… Container started

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 6: WAIT FOR INITIALIZATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Waiting 60 seconds for full initialization...
......... 10......... 20......... 30......... 40......... 50......... 60

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
STEP 7: VERIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ… Container is running

Checking HTTP response...
âœ… HTTP server responding

Checking for Redis connection errors...
âœ… NO Redis connection errors found

Checking for encryption errors...
âœ… NO encryption errors found

Recent logs (last 30 lines):
============================
2025-10-03 22:13:52.713 "runner.installTracer" is not a valid config option. If you previously had this config option set, it may have been removed.
2025-10-03 22:13:52.713 "runner.fixMatplotlib" is not a valid config option. If you previously had this config option set, it may have been removed.
2025-10-03 22:13:52.713 "ui.hideSidebarNav" is not a valid config option. If you previously had this config option set, it may have been removed.

  You can now view your Streamlit app in your browser.

  URL: http://localhost:5000


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ðŸŽ‰ FIX COMPLETE!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Summary of changes:
  âœ… Fresh DATAGUARDIAN_MASTER_KEY generated
  âœ… Fresh JWT_SECRET generated
  âœ… Redis configured for localhost:6379
  âœ… All encrypted cache cleared
  âœ… Container running with --network host

ðŸ§ª TEST NOW (IMPORTANT):

  1. Open INCOGNITO/PRIVATE browser window
  2. Visit: https://dataguardianpro.nl
  3. Login: vishaal314 / password123
  4. Check dashboard loads WITHOUT errors
  5. Try Code Scanner

ðŸ“Š Monitor logs:
  docker logs dataguardian-container -f

Expected results:
  âœ… No 'All Redis connection attempts failed'
  âœ… No 'Incorrect padding' errors
  âœ… Dashboard loads successfully
  âœ… All scanners working

âš ï¸  IMPORTANT NOTES:
  - Previous encrypted data has been cleared
  - User sessions will be fresh
  - Any cached scan results will regenerate
  - New encryption keys will be used going forward

If errors persist, check:
  1. Redis is running: redis-cli ping
  2. Container can access Redis: docker exec dataguardian-container redis-cli -h localhost ping
  3. Environment file: cat /root/.dataguardian_env
root@vishaalnoord7:~# docker logs dataguardian-container -f
2025-10-03 22:13:52.713 "runner.installTracer" is not a valid config option. If you previously had this config option set, it may have been removed.
2025-10-03 22:13:52.713 "runner.fixMatplotlib" is not a valid config option. If you previously had this config option set, it may have been removed.
2025-10-03 22:13:52.713 "ui.hideSidebarNav" is not a valid config option. If you previously had this config option set, it may have been removed.

  You can now view your Streamlit app in your browser.

  URL: http://localhost:5000

All Redis connection attempts failed. Using in-memory fallback.
2025-10-03 22:15:30,713 - scanner.code_profiler - INFO - System monitoring started
2025-10-03 22:15:31,243 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: nl
2025-10-03 22:15:31,773 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.526s, Memory: 2.7MB
2025-10-03 22:15:36,777 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: nl
2025-10-03 22:15:37,440 - utils.secure_auth_enhanced - INFO - User vishaal314 authenticated successfully
2025-10-03 22:15:37,444 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.663s, Memory: 0.8MB
2025-10-03 22:15:37,530 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: nl
2025-10-03 22:15:37,551 - utils.session_optimizer - INFO - Created session b8a3852a-bd6e-435c-9469-23e20bc07e5b for user vishaal314
2025-10-03 22:15:37,579 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:37,589 - services.license_manager - INFO - License saved: DGP-ENT-2025-001
2025-10-03 22:15:37,592 - services.license_manager - INFO - License saved: DGP-ENT-2025-001
2025-10-03 22:15:37,599 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:15:39,339 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:39,340 - __main__ - ERROR - Error loading dashboard metrics: KMS initialization failed: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:39,342 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:39,343 - __main__ - ERROR - Fallback dashboard failed: KMS initialization failed: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:39,357 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 1.825s, Memory: 81.8MB
LANGUAGE CHANGE: nl -> en
LANGUAGE SELECTOR - Changed language to: en
SET_LANGUAGE - Setting language to: en
INIT - Successfully initialized translations for: en
2025-10-03 22:15:42,125 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-03 22:15:42,129 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.001s, Memory: 0.0MB
2025-10-03 22:15:42,258 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:15:42,312 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:42,345 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:15:42,359 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:42,360 - __main__ - ERROR - Error loading dashboard metrics: KMS initialization failed: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:42,361 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:42,361 - __main__ - ERROR - Fallback dashboard failed: KMS initialization failed: Failed to derive local KEK: Incorrect padding
2025-10-03 22:15:42,374 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.113s, Memory: 0.5MB
INIT - Successfully initialized translations for: en
2025-10-03 22:15:44,165 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-03 22:15:44,202 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:44,235 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:15:44,274 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
SET_LANGUAGE - Setting language to: en
INIT - Successfully initialized translations for: en
2025-10-03 22:15:44,576 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.410s, Memory: 5.2MB
2025-10-03 22:15:47,565 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:15:47,608 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:47,622 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:15:47,646 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:47,666 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.097s, Memory: 0.0MB
2025-10-03 22:15:50,574 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:15:50,618 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:50,639 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:15:50,675 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:15:50,706 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.123s, Memory: 0.8MB
2025-10-03 22:16:00,222 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:00,262 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:00,273 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:00,312 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:00,347 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.118s, Memory: 0.5MB
2025-10-03 22:16:00,503 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:00,556 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:00,567 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:00,602 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:00,824 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:16:00,825 - scanner.code_profiler - INFO - Activity tracked: b8a3852a-bd6e-435c-9469-23e20bc07e5b - error
2025-10-03 22:16:00,833 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.329s, Memory: 3.5MB
2025-10-03 22:16:24,055 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: nl
2025-10-03 22:16:24,107 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.048s, Memory: 0.5MB
LANGUAGE CHANGE: nl -> en
LANGUAGE SELECTOR - Changed language to: en
SET_LANGUAGE - Setting language to: en
INIT - Successfully initialized translations for: en
2025-10-03 22:16:27,117 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-03 22:16:27,121 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.001s, Memory: 0.0MB
2025-10-03 22:16:27,264 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:27,596 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.330s, Memory: 1.0MB
2025-10-03 22:16:30,481 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:31,175 - utils.secure_auth_enhanced - INFO - User vishaal314 authenticated successfully
2025-10-03 22:16:31,179 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.695s, Memory: 0.5MB
INIT - Successfully initialized translations for: en
2025-10-03 22:16:31,316 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-03 22:16:31,330 - utils.session_optimizer - INFO - Created session c4938ae2-d417-41fa-9417-41149810f9cb for user vishaal314
2025-10-03 22:16:31,350 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:31,367 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:31,382 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:16:31,384 - __main__ - ERROR - Error loading dashboard metrics: KMS initialization failed: Failed to derive local KEK: Incorrect padding
2025-10-03 22:16:31,386 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:16:31,387 - __main__ - ERROR - Fallback dashboard failed: KMS initialization failed: Failed to derive local KEK: Incorrect padding
2025-10-03 22:16:31,394 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.076s, Memory: 0.3MB
2025-10-03 22:16:34,777 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:34,826 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:34,845 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:34,891 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
SET_LANGUAGE - Setting language to: en
INIT - Successfully initialized translations for: en
2025-10-03 22:16:35,018 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.238s, Memory: 0.8MB
2025-10-03 22:16:38,187 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:38,231 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:38,251 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:38,288 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:38,333 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.141s, Memory: 0.0MB
2025-10-03 22:16:40,671 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:40,712 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:40,738 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:40,782 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:40,801 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.129s, Memory: 0.8MB
2025-10-03 22:16:46,384 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:46,431 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:46,460 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:46,488 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:46,512 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.119s, Memory: 0.8MB
2025-10-03 22:16:46,669 - __main__ - INFO - Performance optimizations initialized successfully
INIT - Successfully initialized translations for: en
2025-10-03 22:16:46,706 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:46,715 - services.license_manager - INFO - License loaded: DGP-ENT-2025-001
2025-10-03 22:16:46,758 - services.usage_analytics - INFO - Usage event tracked: user_login for user vishaal314_1bfc0314036d89d7
2025-10-03 22:16:46,799 - scanner.code_profiler - INFO - Activity tracked: c4938ae2-d417-41fa-9417-41149810f9cb - error
2025-10-03 22:16:46,798 - services.encryption_service - ERROR - Failed to initialize KMS providers: Failed to derive local KEK: Incorrect padding
2025-10-03 22:16:46,811 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.134s, Memory: -18.0MB