═══════════════════════════════════════════════════════════════════════════════
SYSTEM ARCHITECTURE AND PROCESSING FLOWCHART
AI Model Scanner - Systeem Architectuur
═══════════════════════════════════════════════════════════════════════════════


     MODEL INPUT           →   FRAMEWORK DETECTION          →   PARAMETER ANALYSIS

    PyTorch (.pt, .pth)           Automatic Detection            Count: <1M = Low Risk

   TensorFlow (.h5, .pb)        File Extension + Header         Count: 1M-100M = Medium

      ONNX (.onnx)               Magic Number Check              Count: 100M-1B = High

     scikit-learn (.pkl)           Object Inspection             Count: >1B = Very High



             ↓                             ↓                                ↓



    BIAS DETECTION         →   EU AI ACT COMPLIANCE         → NETHERLANDS COMPLIANCE

   Demographic Parity             Article 5: Prohibited          BSN Pattern Detection
   (96% Accuracy)                 Practices (98%)                (99% Accuracy)

     Equalized Odds             Articles 19-24: High-Risk        UAVG Validation
     (94% Accuracy)              Systems (97%)                   (AP Authority)

     Calibration Score            Articles 51-55: GPAI           Regional Multipliers
     (95% Accuracy)               Models (99%)                   (Netherlands-specific)

    Individual Fairness           Penalty Calculation            Dutch Legal Guidance
     (97% Accuracy)               (EUR 35M / EUR 15M)            (100% Coverage)



             ↓                             ↓                                ↓



   RISK ASSESSMENT         →    REPORT GENERATION           → COMPLIANCE CERTIFICATE

   Overall Score: 0-100            PDF/HTML/JSON Output           Digital Verification
   (Real-time calculation)         (<5 seconds generation)        (AP Authority Stamp)

    Risk Classification         Technical Documentation         Legal Framework
   (98%+ Accuracy)               (Comprehensive)                 (Netherlands UAVG)

    Penalty Estimation            Remediation Guide              Enterprise Integration
   (100% Accurate)                (Actionable recommendations)   (API endpoints)


═══════════════════════════════════════════════════════════════════════════════

DETAILED COMPONENT ARCHITECTURE:

┌─────────────────────────────────────────────────────────────────────────────┐
│                         FRONTEND LAYER (Streamlit)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  • User Interface (Dutch/English)                                           │
│  • Model Upload (drag-and-drop, file browser)                               │
│  • Real-time Progress Tracking                                              │
│  • Interactive Report Viewer                                                │
│  • Compliance Certificate Download                                          │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                      BUSINESS LOGIC LAYER (Python)                          │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────────┬──────────────────────┬────────────────────────┐  │
│  │ Multi-Framework      │ Bias Detection       │ EU AI Act Compliance   │  │
│  │ Analyzer             │ Engine               │ Assessor               │  │
│  │ • PyTorch Support    │ • Demographic Parity │ • Article 5 Scanner    │  │
│  │ • TensorFlow Support │ • Equalized Odds     │ • Articles 19-24 Valid │  │
│  │ • ONNX Support       │ • Calibration Score  │ • Articles 51-55 Check │  │
│  │ • scikit-learn Supp. │ • Individual Fairness│ • Penalty Calculation  │  │
│  └──────────────────────┴──────────────────────┴────────────────────────┘  │
│                                                                             │
│  ┌──────────────────────┬──────────────────────┬────────────────────────┐  │
│  │ Netherlands Module   │ Real-time Monitor    │ Report Generator       │  │
│  │ • BSN Detection      │ • Continuous Scan    │ • PDF Output           │  │
│  │ • UAVG Validation    │ • Pattern Matching   │ • HTML Output          │  │
│  │ • AP Integration     │ • Automatic Alerts   │ • JSON API             │  │
│  │ • Regional Penalties │ • Remediation Guide  │ • Certificate Gen      │  │
│  └──────────────────────┴──────────────────────┴────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DATA LAYER (PostgreSQL + Redis)                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────┬────────────────────────────────────┐   │
│  │  PostgreSQL Database           │  Redis Cache                       │   │
│  │  • Scan Results Storage        │  • Multi-level Caching             │   │
│  │  • Compliance History          │  • 90% Hit Rate                    │   │
│  │  • User Activity Logs          │  • <10ms Latency                   │   │
│  │  • Connection Pooling          │  • Performance Optimization        │   │
│  │  • 99% Reliability             │  • Real-time Data                  │   │
│  └────────────────────────────────┴────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════

PROCESSING WORKFLOW - DETAILED STEPS:

STEP 1: MODEL UPLOAD
   ├─ User uploads model file via Streamlit interface
   ├─ File validation (size, format, integrity)
   ├─ Secure storage in temporary directory
   └─ Session isolation for concurrent users

STEP 2: FRAMEWORK DETECTION
   ├─ File extension analysis (.pt, .pth, .h5, .pb, .onnx, .pkl, .joblib)
   ├─ Magic number header inspection
   ├─ Object type detection (Python pickle, HDF5, Protocol Buffer)
   └─ Framework classification (PyTorch, TensorFlow, ONNX, scikit-learn)

STEP 3: ARCHITECTURE ANALYSIS
   ├─ Parameter count extraction
   │  ├─ PyTorch: model.parameters() enumeration
   │  ├─ TensorFlow: model.count_params()
   │  ├─ ONNX: graph node traversal
   │  └─ scikit-learn: estimator inspection
   ├─ Layer configuration mapping
   ├─ Model complexity classification (<1M, 1M-100M, 100M-1B, >1B)
   └─ Risk level determination (Low, Medium, High, Very High)

STEP 4: BIAS DETECTION
   ├─ Demographic Parity Calculation
   │  └─ P(Y=1|A=0) ≈ P(Y=1|A=1) with threshold 0.80
   ├─ Equalized Odds Evaluation
   │  └─ TPR_A=0 ≈ TPR_A=1 AND FPR_A=0 ≈ FPR_A=1
   ├─ Calibration Score Measurement
   │  └─ P(Y=1|Score=s,A=0) ≈ P(Y=1|Score=s,A=1)
   ├─ Individual Fairness Testing
   │  └─ d(f(x1),f(x2)) ≤ L*d(x1,x2) with L=1.0
   └─ Bias score aggregation (0-100 scale)

STEP 5: EU AI ACT COMPLIANCE ASSESSMENT
   ├─ Article 5 Prohibited Practices Check
   │  ├─ Social scoring detection
   │  ├─ Manipulation technique identification
   │  ├─ Subliminal technique detection
   │  ├─ Biometric identification assessment
   │  └─ Penalty: EUR 35M or 7% global turnover
   ├─ Articles 19-24 High-Risk Systems Validation
   │  ├─ Quality Management System requirements
   │  ├─ Technical documentation completeness
   │  ├─ Record-keeping compliance
   │  ├─ CE marking verification
   │  └─ Penalty: EUR 15M or 3% global turnover
   └─ Articles 51-55 GPAI Model Assessment
      ├─ Parameter count threshold (>1 billion)
      ├─ Compute capacity limits
      ├─ Adversarial testing requirements
      └─ Penalty: EUR 15M or 3% global turnover

STEP 6: NETHERLANDS SPECIALIZATION
   ├─ BSN Detection (CORRECTED ALGORITHM)
   │  ├─ 9-digit pattern recognition (\b\d{9}\b)
   │  ├─ Checksum validation:
   │  │  checksum = (digit_0 × 9) + (digit_1 × 8) + (digit_2 × 7) + 
   │  │             (digit_3 × 6) + (digit_4 × 5) + (digit_5 × 4) + 
   │  │             (digit_6 × 3) + (digit_7 × 2) - (digit_8 × 1)
   │  │  BSN valid if: checksum mod 11 == 0
   │  └─ Privacy risk assessment (GDPR Article 9)
   ├─ UAVG Compliance Validation
   │  ├─ Nederlandse Autoriteit Persoonsgegevens (AP) integration
   │  ├─ Data residency requirements (Netherlands/EU)
   │  ├─ Local representative obligations
   │  └─ Dutch language policy requirements
   └─ Regional Penalty Calculation
      ├─ Netherlands-specific multipliers
      ├─ UAVG violation penalties
      └─ Combined EU + NL penalty estimation

STEP 7: RISK AGGREGATION
   ├─ Overall risk score calculation (0-100)
   ├─ Risk category classification (Low, Medium, High, Critical)
   ├─ Penalty exposure estimation
   └─ Remediation priority ranking

STEP 8: REPORT GENERATION
   ├─ PDF Report Generation (<5 seconds)
   │  ├─ Executive summary
   │  ├─ Technical findings
   │  ├─ Bias detection results
   │  ├─ EU AI Act compliance status
   │  ├─ Netherlands-specific findings
   │  └─ Remediation recommendations
   ├─ HTML Interactive Report
   │  ├─ Filterable findings
   │  ├─ Visual risk dashboard
   │  └─ Downloadable sections
   └─ JSON API Response
      └─ Machine-readable results for API integration

STEP 9: COMPLIANCE CERTIFICATE
   ├─ Digital certificate generation
   ├─ QR code with verification URL
   ├─ AP Authority stamp (Netherlands)
   ├─ Unique certificate ID
   └─ Legal framework references (EU AI Act, UAVG)

STEP 10: DATABASE STORAGE
   ├─ Scan results persistence
   ├─ Compliance history tracking
   ├─ User activity logging
   └─ Audit trail creation


═══════════════════════════════════════════════════════════════════════════════

DEPLOYMENT ARCHITECTURE:

┌─────────────────────────────────────────────────────────────────────────────┐
│                         PRODUCTION DEPLOYMENT                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐    │
│  │ Load Balancer   │      │ Docker Swarm /  │      │ Monitoring &    │    │
│  │ (nginx/HAProxy) │◄────►│ Kubernetes      │◄────►│ Logging         │    │
│  └─────────────────┘      └─────────────────┘      │ (Prometheus)    │    │
│         │                          │                └─────────────────┘    │
│         ▼                          ▼                                       │
│  ┌──────────────────────────────────────────────────────────────────┐     │
│  │              AI Model Scanner Instances (Replicated)             │     │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐         │     │
│  │  │Instance 1│  │Instance 2│  │Instance 3│  │Instance N│         │     │
│  │  │Port: 5000│  │Port: 5001│  │Port: 5002│  │Port: 500N│         │     │
│  │  └──────────┘  └──────────┘  └──────────┘  └──────────┘         │     │
│  └──────────────────────────────────────────────────────────────────┘     │
│                              │                                             │
│                              ▼                                             │
│  ┌──────────────────────────────────────────────────────────────────┐     │
│  │                  Shared Services Layer                           │     │
│  │  ┌───────────────────┐         ┌────────────────────────┐        │     │
│  │  │ PostgreSQL        │         │ Redis Cluster          │        │     │
│  │  │ (Master/Replica)  │         │ (Multi-node)           │        │     │
│  │  │ Connection Pool   │         │ Persistence Enabled    │        │     │
│  │  └───────────────────┘         └────────────────────────┘        │     │
│  └──────────────────────────────────────────────────────────────────┘     │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════

SECURITY ARCHITECTURE:

┌─────────────────────────────────────────────────────────────────────────────┐
│                            SECURITY LAYERS                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  Layer 1: Network Security                                                  │
│  ├─ HTTPS/TLS 1.3 encryption                                                │
│  ├─ Firewall rules (only port 5000 exposed)                                 │
│  ├─ DDoS protection                                                          │
│  └─ IP whitelist support                                                     │
│                                                                             │
│  Layer 2: Application Security                                              │
│  ├─ JWT token authentication                                                 │
│  ├─ Role-based access control (7 roles)                                      │
│  ├─ Session isolation (multi-user)                                           │
│  ├─ Input validation and sanitization                                        │
│  └─ SQL injection prevention (ORM-based)                                     │
│                                                                             │
│  Layer 3: Data Security                                                      │
│  ├─ At-rest encryption (AES-256)                                             │
│  ├─ In-transit encryption (TLS 1.3)                                          │
│  ├─ Automatic file cleanup (temp directories)                                │
│  ├─ Secure credential storage (environment variables)                        │
│  └─ Audit logging (complete activity trail)                                  │
│                                                                             │
│  Layer 4: Compliance Security                                                │
│  ├─ GDPR data protection                                                     │
│  ├─ UAVG Netherlands privacy law                                             │
│  ├─ EU AI Act security requirements                                          │
│  ├─ ISO 27001 aligned controls                                               │
│  └─ SOC 2 security standards                                                 │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
END OF SYSTEM ARCHITECTURE
═══════════════════════════════════════════════════════════════════════════════
