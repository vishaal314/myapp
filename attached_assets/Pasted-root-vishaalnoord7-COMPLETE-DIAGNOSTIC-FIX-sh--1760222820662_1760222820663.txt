root@vishaalnoord7:~# ./COMPLETE_DIAGNOSTIC_FIX.sh

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  COMPLETE DIAGNOSTIC & FIX                                     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


DIAGNOSTIC 1: Check if new code is in /opt/dataguardian
Checking multi_tenant_service.py for DISABLE_RLS check:
âœ… Found DISABLE_RLS check in source file

DIAGNOSTIC 2: Check if new code is in container
âŒ DISABLE_RLS check NOT in container - rebuild failed!

DIAGNOSTIC 3: Check environment variable
âŒ DISABLE_RLS not set

DIAGNOSTIC 4: Check database RLS status

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
APPLYING COMPLETE FIX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FIX 1: Ensure DISABLE_RLS=1 in .env
âœ… DISABLE_RLS=1 in .env

FIX 2: Disable RLS on database NOW

FIX 3: Remove old container completely
dataguardian-container
dataguardian-container
Untagged: dataguardian:latest
Deleted: sha256:7daf784cd6635ee2a01a04fe0fd7b5fd740cfe0b8eca632fc459a069754c985e
âœ… Old container and image removed

FIX 4: Rebuild with --no-cache AND --pull (3-4 min)
#9 123.9   Building wheel for svglib (setup.py): finished with status 'done'
#9 123.9   Created wheel for svglib: filename=svglib-1.5.1-py3-none-any.whl size=30948 sha256=b27dc332ca0fbb9d5b30efb1b4cad9b1f2b34eecbc7c86cfbf6d9a516089aaa4
#9 123.9   Stored in directory: /tmp/pip-ephem-wheel-cache-9_jpzp82/wheels/7e/01/0e/e6e336915d6e8448890a695770ba88fe030cc71060988016f6
#9 123.9 Successfully built svglib
#9 124.9 Installing collected packages: webencodings, pytz, py-spy, pdfkit, mpmath, flatbuffers, brotli, zopfli, xlrd, watchdog, urllib3, tzlocal, tzdata, typing-extensions, tqdm, tornado, toml, tld, tinyhtml5, tinycss2, tenacity, sympy, soupsieve, sniffio, smmap, six, rpds-py, regex, redis, pyyaml, python-multipart, python-magic, Pyphen, pypdf2, pyjwt, pygments, pydyf, pycryptodome, pycparser, pyasn1, pyarrow, psycopg2-binary, psutil, protobuf, propcache, pluggy, pillow, packaging, numpy, narwhals, mysql-connector-python, multidict, markupsafe, markdown2, lxml, joblib, jiter, itsdangerous, isodate, iniconfig, idna, humanfriendly, h11, frozenlist, fonttools, filelock, et-xmlfile, docstring-parser, dnspython, distro, coverage, click, charset_normalizer, certifi, cachetools, blinker, bcrypt, babel, attrs, annotated-types, aiohappyeyeballs, yarl, xmlsec, werkzeug, typing-inspection, rsa, requests, reportlab, referencing, python-docx, python-dateutil, pytest, pytesseract, pydantic-core, psycopg2-pool, plotly, openpyxl, opencv-python-headless, ml_dtypes, memory-profiler, lxml_html_clean, jinja2, httpcore, gitdb, ecdsa, cssselect2, courlan, coloredlogs, cffi, beautifulsoup4, anyio, aiosignal, weasyprint, svglib, stripe, requests-file, python3-saml, python-whois, python-jose, pytest-cov, pydeck, pydantic, pandas, onnxruntime, onnx, jsonschema-specifications, httpx, gitpython, flask, dateparser, cryptography, aiohttp, tldextract, openai, justext, jsonschema, htmldate, authlib, anthropic, trafilatura, altair, streamlit
#9 228.0
#9 228.0 Successfully installed Pyphen-0.17.2 aiohappyeyeballs-2.6.1 aiohttp-3.13.0 aiosignal-1.4.0 altair-5.5.0 annotated-types-0.7.0 anthropic-0.69.0 anyio-4.11.0 attrs-25.4.0 authlib-1.6.5 babel-2.17.0 bcrypt-5.0.0 beautifulsoup4-4.14.2 blinker-1.9.0 brotli-1.1.0 cachetools-6.2.0 certifi-2025.10.5 cffi-2.0.0 charset_normalizer-3.4.3 click-8.3.0 coloredlogs-15.0.1 courlan-1.3.2 coverage-7.10.7 cryptography-46.0.2 cssselect2-0.8.0 dateparser-1.2.2 distro-1.9.0 dnspython-2.8.0 docstring-parser-0.17.0 ecdsa-0.19.1 et-xmlfile-2.0.0 filelock-3.20.0 flask-3.1.2 flatbuffers-25.9.23 fonttools-4.60.1 frozenlist-1.8.0 gitdb-4.0.12 gitpython-3.1.45 h11-0.16.0 htmldate-1.9.3 httpcore-1.0.9 httpx-0.28.1 humanfriendly-10.0 idna-3.10 iniconfig-2.1.0 isodate-0.7.2 itsdangerous-2.2.0 jinja2-3.1.6 jiter-0.11.0 joblib-1.5.2 jsonschema-4.25.1 jsonschema-specifications-2025.9.1 justext-3.0.2 lxml-5.4.0 lxml_html_clean-0.4.3 markdown2-2.5.4 markupsafe-3.0.3 memory-profiler-0.61.0 ml_dtypes-0.5.3 mpmath-1.3.0 multidict-6.7.0 mysql-connector-python-9.4.0 narwhals-2.7.0 numpy-2.2.6 onnx-1.19.1 onnxruntime-1.23.1 openai-2.3.0 opencv-python-headless-4.12.0.88 openpyxl-3.1.5 packaging-25.0 pandas-2.3.3 pdfkit-1.0.0 pillow-11.3.0 plotly-6.3.1 pluggy-1.6.0 propcache-0.4.1 protobuf-6.32.1 psutil-7.1.0 psycopg2-binary-2.9.11 psycopg2-pool-1.2 py-spy-0.4.1 pyarrow-21.0.0 pyasn1-0.6.1 pycparser-2.23 pycryptodome-3.23.0 pydantic-2.12.0 pydantic-core-2.41.1 pydeck-0.9.1 pydyf-0.11.0 pygments-2.19.2 pyjwt-2.10.1 pypdf2-3.0.1 pytesseract-0.3.13 pytest-8.4.2 pytest-cov-7.0.0 python-dateutil-2.9.0.post0 python-docx-1.2.0 python-jose-3.5.0 python-magic-0.4.27 python-multipart-0.0.20 python-whois-0.9.6 python3-saml-1.16.0 pytz-2025.2 pyyaml-6.0.3 redis-6.4.0 referencing-0.36.2 regex-2025.9.18 reportlab-4.4.4 requests-2.32.5 requests-file-2.1.0 rpds-py-0.27.1 rsa-4.9.1 six-1.17.0 smmap-5.0.2 sniffio-1.3.1 soupsieve-2.8 streamlit-1.50.0 stripe-13.0.1 svglib-1.5.1 sympy-1.14.0 tenacity-9.1.2 tinycss2-1.4.0 tinyhtml5-2.0.0 tld-0.13.1 tldextract-5.3.0 toml-0.10.2 tornado-6.5.2 tqdm-4.67.1 trafilatura-2.0.0 typing-extensions-4.15.0 typing-inspection-0.4.2 tzdata-2025.2 tzlocal-5.3.1 urllib3-2.5.0 watchdog-6.0.0 weasyprint-66.0 webencodings-0.5.1 werkzeug-3.1.3 xlrd-2.0.2 xmlsec-1.3.16 yarl-1.22.0 zopfli-0.2.3.post1
#9 228.0 WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
#9 233.1 WARNING: No matching packages
#9 233.1 Files removed: 0 (0 bytes)
#9 DONE 233.9s

#10 [6/9] COPY . .
#10 DONE 0.4s

#11 [7/9] RUN mkdir -p logs reports data temp
#11 DONE 0.7s

#12 [8/9] RUN useradd --create-home --shell /bin/bash dataguardian &&     chown -R dataguardian:dataguardian /app
#12 DONE 1.7s

#13 [9/9] RUN mkdir -p ~/.streamlit &&     echo '[server]\nheadless = true\naddress = "0.0.0.0"\nport = 5000\nenableCORS = false\nenableXsrfProtection = false\n\n[browser]\ngatherUsageStats = false\n\n[theme]\nbase = "light"' > ~/.streamlit/config.toml
#13 DONE 0.5s

#14 exporting to image
#14 exporting layers
#14 exporting layers 46.1s done
#14 writing image sha256:3b1ddc210b884c633c0b6594168076a04457ddde39db385ca6bc7da373346b66 done
#14 naming to docker.io/library/dataguardian:latest 0.0s done
#14 DONE 46.2s

FIX 5: Start new container with all env vars
917349f89d7f60246efe69dbdac67b583b563a575ed0236e8d751c6c7ac42188
âœ… Container started

FIX 6: Wait 35 seconds for full startup

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
VERIFICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERIFY 1: Check logs for RLS status
âš ï¸  No RLS messages (might be OK)

VERIFY 2: Check database access

VERIFY 3: Test ResultsAggregator

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ‰ COMPLETE FIX APPLIED!

NOW TEST:
   1. https://dataguardianpro.nl
   2. HARD REFRESH: Ctrl + Shift + R
   3. Go to: ğŸ“Š Scan Results
   4. You should see all scans!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
root@vishaalnoord7:~# docker logs dataguardian-container | tail -150
All Redis connection attempts failed. Using in-memory fallback.
2025-10-11 22:45:33,934 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-11 22:45:38,108 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-11 22:45:43,975 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-11 22:45:48,940 - __main__ - INFO - Performance optimizations initialized successfully
2025-10-11 22:45:51,824 - __main__ - INFO - Performance optimizations initialized successfully

  You can now view your Streamlit app in your browser.

  URL: http://0.0.0.0:5000

2025-10-11 22:45:33,278 - scanner.code_profiler - INFO - System monitoring started
INIT - Successfully initialized translations for: en
2025-10-11 22:45:35,119 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 1.174s, Memory: 2.5MB
INIT - Successfully initialized translations for: en
2025-10-11 22:45:38,197 - scanner.code_profiler - INFO - Activity tracked: unknown - error
2025-10-11 22:45:38,228 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.115s, Memory: 0.0MB
INIT - Successfully initialized translations for: en
2025-10-11 22:45:44,009 - scanner.code_profiler - INFO - Activity tracked: unknown - error
2025-10-11 22:45:44,018 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.036s, Memory: 0.5MB
INIT - Successfully initialized translations for: en
2025-10-11 22:45:49,601 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.649s, Memory: -0.7MB
INIT - Successfully initialized translations for: en
2025-10-11 22:45:51,849 - scanner.code_profiler - INFO - Activity tracked: unknown - error
2025-10-11 22:45:51,854 - scanner.code_profiler - INFO - Performance Monitor [main_app_initialization]: 0.027s, Memory: 0.5MB
root@vishaalnoord7:~#